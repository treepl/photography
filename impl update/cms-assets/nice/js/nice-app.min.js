'use strict';(function(){function u(){v();var a=document.querySelectorAll('nice-editable-text:not([data-not_froala="true"])');let b=document.querySelectorAll('nice-editable-text[data-not_froala="true"]');for(var e=0;e<a.length;e++){let b=a[e],d=b.dataset.holder_id,f=b.dataset.text_id,g=n[d].PropertyType,h=n[d].Type;b.addEventListener("click",function(){if("TextBoxMultiple"===g||"Template"===h||"File"===h||"Layout"===h||"Snippet"===h||"Form"===h)b.getElementsByClassName("fr-wrapper").length||setTimeout(()=>
{let a=new FroalaEditor(b,{key:"te1C2sB5B6B4B4B4E4jC1QUd1Xd1OZJ1ABVJRDRNGGUE1ITrE1D4A3A11B1B6E6B1F4G3==",toolbarInline:!0,charCounterCount:!1,toolbarButtons:"bold italic underline strikeThrough subscript superscript - insertLink textColor backgroundColor selectAll clearFormatting | undo redo".split(" "),htmlAllowedTags:"a br em s span strong sub sup u nice-editable-text".split(" "),htmlUntouched:!0,autofocus:!0,zIndex:99999,quickInsertEnabled:!1,linkInsertButtons:["linkBack"],linkList:[],events:{blur:function(){a.destroy();
setTimeout(()=>{q(d,f,b.innerHTML)},0)},contentChanged:function(){b.dataset.property_changed=!0}}})},0)})}for(a=0;a<b.length;a++)e=b[a],e.addEventListener("keyup",function(a){a.target.dataset.property_changed=!0}),e.addEventListener("keypress",function(a){a.target.dataset.property_changed=!0}),e.addEventListener("focusout",function(a){a=a.target;let b=a.innerHTML.replace(/<br\s*\/?>/gm,"\r\n");b=b.replace(/(<(\/?[^>]+)>)/gm,"");b=b.replace(/\r\n/gm,"<br />");b=b.replace(/<br\s*\/?>\s*$/g,"");a.innerHTML=
b;q(a.dataset.holder_id,a.dataset.text_id,b)})}function v(){var a=document.querySelectorAll("button"),b=document.querySelectorAll('input[type="button"]'),e=document.querySelectorAll("a"),c=document.querySelectorAll("label"),d=document.querySelectorAll("form"),f=document.querySelectorAll("[onclick]"),g=document.querySelectorAll("nice-editable-text");let h=document.body;r(a);r(b);for(b=0;b<a.length;b++)a[b].classList.remove("waves-effect");for(a=0;a<c.length;a++)c[a].removeAttribute("for");for(c=0;c<
d.length;c++)d[c].removeAttribute("action");setInterval(function(){h.getAttribute("contenteditable")&&h.removeAttribute("contenteditable")},100);for(d=0;d<f.length;d++)c=f[d],a=c.getAttribute("onclick"),c.setAttribute("ondblclick",a),c.removeAttribute("onclick");for(f=0;f<g.length;f++){b=g[f];d=b.dataset.holder_id;c=b.dataset.text_id;let e=n[d].Type;a=b.innerText;"TextBoxMultiple"!==n[d].PropertyType&&"Template"!==e&&"Form"!==e&&"File"!==e&&"Layout"!==e&&"Snippet"!==e?(b.setAttribute("contenteditable",
!0),b.setAttribute("data-not_froala",!0)):(b=w(b,a),"nice-editable-text"!==b.nodeName.toLowerCase()&&(b.getElementsByTagName("nice-editable-text")[0].parentElement.replaceChild(document.createTextNode(a),b.querySelector("nice-editable-text")),a=document.createElement("nice-editable-text"),a.dataset.holder_id=d,a.dataset.text_id=c,b.parentNode.insertBefore(a,b),a.appendChild(b)))}for(g=0;g<e.length;g++)f=e[g],f.classList.remove("waves-effect"),f.getAttribute("href")?0!==f.getAttribute("href").indexOf("#")&&
"javascript:"!==f.getAttribute("href")?f.querySelectorAll("nice-editable-text").length&&(f.setAttribute("data-href",f.getAttribute("href")),f.setAttribute("href","javascript:"),f.addEventListener("dblclick",function(a){a=a.target.closest("a");if(a.dataset.href.length||"#"!==a.dataset.href||"javascript:"!==a.dataset.href)window.location=a.dataset.href;return!1})):f.setAttribute("href","javascript:"):f.setAttribute("href","javascript:");let p=document.querySelectorAll("*");document.addEventListener("click",
function(){for(let a=0;a<p.length;a++)p[a].onselectstart=null});e=document.querySelectorAll("nice-editable-text a");for(g=0;g<e.length;g++)e[g].addEventListener("click",function(a){a.preventDefault()})}function q(a,b,e){a=document.querySelectorAll(`nice-editable-text[data-holder_id="${a}"][data-text_id="${b}"]`);for(b=0;b<a.length;b++)a[b].innerHTML=e}function w(a,b){let e="a br em s span strong sub sup u".split(" "),c=x(a);for(let d=0;d<c.length;d++){let f=c[d].nodeName.toLowerCase(),g=c[d].innerText;
if(-1!==e.findIndex((a)=>a===f)&&g.trim()===b.trim())a=c[d];else return a}}function t(a,b){let e=a.parentNode;return-1!=="a br em s span strong sub sup u".split(" ").findIndex((a)=>a===e.nodeName.toLowerCase())&&e.textContent.trim()===b.trim()?t(e,b):a}function y(){var a=document.createElement("div");a.classList.add("nICE-control-panel");a.innerHTML='\t<button class="nICE-btn niceSaveBtn">\n\t\tSave\n\t\t<svg class="nICE-spinner" width="17px" height="17px" viewBox="0 0 66 66" xmlns="http://www.w3.org/2000/svg">\n\t\t\t<circle class="path" fill="none" stroke-width="6" stroke-linecap="round" cx="33" cy="33" r="30"></circle>\n\t\t</svg>\n\t</button>\n\t<button class="nICE-clear-btn niceExitBtn">EXIT On-Site Editor</button>';
document.body.appendChild(a);a=document.querySelectorAll(".niceSaveBtn:not(.saved)")[0];let b=document.getElementsByClassName("niceExitBtn")[0];a.addEventListener("click",function(a){let e=a.target;e.classList.add("saved");b.style.display="none";setTimeout(()=>{let a=[],f=!1;document.querySelectorAll('[data-property_changed="true"]').forEach((d,c)=>{var g=d.dataset.holder_id,h=d.dataset.text_id;c=n[g];if("TextBoxMultiple"===c.PropertyType||"Template"===c.Type||"File"===c.Type||"Layout"===c.Type||
"Form"===c.Type||"Snippet"===c.Type){let a,k=decodeURIComponent(c.Layout);k=k.replace(/<(img|hr|br|input)(>)|<((img|hr|br|input)[^>]*?[^\/])(>)/gim,"<$1$3 /$2$5");k=k.replace(/(<[^\/>][^>]*>)(<\/[^>]+>)/gim,"$1var$2");k=k.replace(/&/gim,"&amp;");k=z(k);a="Template"===c.Type||-1!==k.indexOf("</head>")?(new DOMParser).parseFromString(k,"text/xml"):(new DOMParser).parseFromString(`<html><head></head><body>${k}</body></html>`,"text/xml");if(a.querySelector("parsererror"))return alert(`This page contains the following errors:\n\r ${a.querySelector("parsererror").querySelector("div").innerText}`),
f=!0,e.classList.remove("saved"),b.style.display="block",!1;g=a.querySelectorAll(`nice-editable-text[data-holder_id="${g}"][data-text_id="${h}"]`);for(h=0;h<g.length;h++){var l=g[h],m=l.textContent;m=m.replace("/&/gim","&amp;");let a=t(l,m);"nice-editable-text"!==a.nodeName.toLowerCase()?(l=a,m=document.createElement("nice-editable-text"),l.parentNode.insertBefore(m,l),m.appendChild(l),""!==d.innerHTML?a.outerHTML=d.innerHTML:a.parentElement.innerHTML="var"):""!==d.innerHTML?(a.innerHTML="",a.appendChild(d.cloneNode(!0))):
a.innerHTML="var"}"Template"!==c.Type||-1===k.indexOf("</head>")?(d=a.getElementsByTagName("body")[0].innerHTML,c.Layout=encodeURIComponent(d.replace(/>var?<\//gim,"></").replace(/&amp;/gim,"&"))):(d=(new XMLSerializer).serializeToString(a),c.Layout=encodeURIComponent(d.replace(/>var?<\//gim,"></")))}else c.Layout=d.innerHTML;a.push(c)});a.forEach((a)=>{let b=decodeURIComponent(a.Layout);a.Layout=encodeURIComponent(b.replace(/(<nice-editable-text .+?>)([\s\S]*?)(<\/nice-editable-text>)/g,"$2").replace(/(<nice-editable-text .+?>)([\s\S]*?)(<\/nice-editable-text>)/g,
"$2"))});f||A("PUT","/api/nice-editor-items/save",a);return!1},0)});b.addEventListener("click",function(){window.location=window.location.pathname+"?OnSiteEditor=0";return!1})}function z(a){let b=/((^|"|')\s+?)(([a-z0-9_-]+?(($|\s+)))+)/gi;var e=a.matchAll(/<[a-z0-9_-]+([^>]*?\s([a-z0-9_-]+?(?=(\s|>)))[^>]*?)>/gi);for(const d of e){e=d[0];var c=d[1];let f=c.replace(b,function(a){return a.replace(/([a-z0-9_-])(\s|$)/gi,'$1=""$2')});c=e.replace(c,f);a=a.replace(e,c)}return a}function r(a){for(let b=
0;b<a.length;b++)a[b].addEventListener("click",function(){return!1})}function x(a,b){void 0===b&&(b=document);let e=[];for(a=a.parentNode;a!==b;)e.push(a),a=a.parentNode;e.push(b);return e}function A(a,b,e,c){let d=new XMLHttpRequest;d.onload=d.onerror=function(){if(200==this.status)c&&c(JSON.parse(d.response)),location.reload();else if(400==this.status){let a=JSON.parse(d.response).Message;alert(a);location.reload()}};d.open(a,b,!0);d.setRequestHeader("Content-Type","application/json");d.send(JSON.stringify(e))}
var n=window.nicePropertiesScope;class B extends HTMLElement{constructor(){super()}}document.addEventListener("DOMContentLoaded",function(a){customElements.define("nice-editable-text",B);y();u()});String.prototype.matchAll=function(a){var b=[];this.replace(a,function(){var a=[].slice.call(arguments,0),c=a.splice(-2);a.index=c[0];a.input=c[1];b.push(a)});return b.length?b:[]}})();
