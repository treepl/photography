'use strict';(function(){function k(){e("submit",".cmsCreateThreadForm",function(a){a.preventDefault();let b=a.target,d=b.querySelectorAll('input[type="submit"]')[0];a=new FormData(b);d.classList.add("disabled");g("POST",b.action,a,function(a){let f=b.closest(".cmsCommentsHolder").getElementsByClassName("cmsCommentsThreadsHolder")[0],c=b.closest(".cmsCommentsHolder").getElementsByClassName("cmsLoadMoreThreadButton")[0];f.innerHTML=a+f.innerHTML;f.getElementsByClassName("cmsNoCommentsMessage").length&&
(f.getElementsByClassName("cmsNoCommentsMessage")[0].style.display="none");c&&(c.dataset.total_items_count=+c.dataset.total_items_count+1);b.reset();d.classList.remove("disabled")},d);return!1});e("submit",".cmsEditCommentForm",function(a){a.preventDefault();let b=a.target,d=b.querySelectorAll('input[type="submit"]')[0];a=new FormData(b);d.classList.add("disabled");g("PUT",b.action,a,function(a){a.length?b.closest(".cmsCommentHolder").outerHTML=a:b.closest(".cmsEditCommentFormHolder").style.display=
"none";d.classList.remove("disabled")},d);return!1});e("submit",".cmsReplyCommentForm",function(a){a.preventDefault();let b=a.target,d=b.querySelectorAll('input[type="submit"]')[0];a=new FormData(b);d.classList.add("disabled");g("POST",b.action,a,function(a){let f=b.closest(".cmsThreadHolder").getElementsByClassName("cmsSubCommentsHolder")[0],c=b.closest(".cmsThreadHolder").getElementsByClassName("cmsLoadMoreCommentsButton")[0];b.closest(".cmsReplyCommentFormHolder").style.display="none";b.reset();
b.closest(".cmsCommentHolder").getElementsByClassName("cmsOpenReplyCommentFormButton")[0].style.display="block";d.classList.remove("disabled");c&&(c.dataset.total_items_count=+c.dataset.total_items_count+1);f.innerHTML=a+f.innerHTML},d);return!1});e("click",".cmsOpenEditCommentFormButton",function(a){a.preventDefault();a.target.closest(".cmsCommentHolder").getElementsByClassName("cmsEditCommentFormHolder")[0].style.display="block";return!1});e("click",".cmsOpenReplyCommentFormButton",function(a){a.preventDefault();
a.target.style.display="none";a.target.closest(".cmsCommentHolder").getElementsByClassName("cmsReplyCommentFormHolder")[0].style.display="block";return!1});e("click",".cmsDeleteCommentButton",function(a){a.preventDefault();confirm("Are you sure you wish to delete comment permanently?")&&g("POST",a.target.href,{},function(b){a.target.closest(".cmsCommentHolder").remove()});return!1});e("click",".cmsDeleteThreadButton",function(a){a.preventDefault();confirm("Are you sure you wish to delete comment permanently?")&&
g("POST",a.target.href,{},function(b){a.target.closest(".cmsThreadHolder").remove()});return!1});e("click",".cmsLoadMoreThreadButton",function(a){a.preventDefault();let b=a.target,d=+b.dataset.current_page,l=+b.dataset.page,f=+b.dataset.limit,c=Math.ceil(+b.dataset.total_items_count/f),e=+b.dataset.comment_limit,m=b.dataset.thread_layout,n=b.dataset.comment_layout;d++;g("GET",`${a.target.href}?page=${l}&limit=${f}&commentLayout=${n}&threadLayout=${m}&commentLimit=${e}`,{},function(f){let e=a.target.closest(".cmsCommentsHolder").getElementsByClassName("cmsCommentsThreadsHolder")[0];
e.innerHTML+=f;d<c?(b.dataset.current_page=d,b.dataset.page=d+1):b.remove()});return!1});e("click",".cmsFlatLoadMoreButton",function(a){a.preventDefault();let b=a.target,d=+b.dataset.current_page,e=+b.dataset.number_of_pages,f=+b.dataset.page,c=+b.dataset.comment_limit,h=b.dataset.comment_layout;d++;g("GET",`${a.target.href}?page=${f}&commentLimit=${c}&layout=${h}`,{},function(c){let f=a.target.closest(".cmsCommentsHolder").getElementsByClassName("cmsCommentsThreadsHolder")[0];f.innerHTML+=c;d<e?
(b.dataset.current_page=d,b.dataset.page=d+1):b.remove()});return!1});e("click",".cmsLoadMoreCommentsButton",function(a){a.preventDefault();let b=a.target,d=+b.dataset.current_page,e=+b.dataset.limit,f=Math.ceil(+b.dataset.total_items_count/e),c=+b.dataset.page,h=b.dataset.layout;d++;g("GET",`${a.target.href}?page=${c}&limit=${e}&layout=${h}`,{},function(c){let e=a.target.closest(".cmsThreadHolder").getElementsByClassName("cmsSubCommentsHolder")[0];e.innerHTML+=c;d<f?(b.dataset.current_page=d,b.dataset.page=
d+1):b.remove()});return!1})}function g(a,b,d,e,f){let c=new XMLHttpRequest;c.onload=c.onerror=function(){if(200==this.status)e&&e(c.response?JSON.parse(c.response):c.response);else if(400==this.status){let a=JSON.parse(c.response).Message;alert(a);f&&f.classList.remove("disabled")}};c.open(a,b,!0);c.send(d)}function e(a,b,d){document.addEventListener(a,function(a){var e=document.querySelectorAll(b);if(e){for(var c=a.target,g=-1;c&&-1===(g=Array.prototype.indexOf.call(e,c));)c=c.parentElement;-1<
g&&d.call(c,a)}})}document.addEventListener("DOMContentLoaded",function(a){k()})})();
